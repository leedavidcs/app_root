# Migration `20200525222437-order-event-model`

This migration has been generated by leedavidcs at 5/25/2020, 10:24:37 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "OrderEventType" AS ENUM ('ExecuteOrders', 'ExpireOrders', 'CleanInvalidOrders');

CREATE TABLE "public"."OrderEvent" (
"scheduledEventId" text  NOT NULL ,"type" "OrderEventType" NOT NULL ,
    PRIMARY KEY ("scheduledEventId"))

ALTER TABLE "public"."Order" ALTER COLUMN "status" SET DEFAULT 'Open',
ALTER COLUMN "timeInForce" SET DEFAULT 'Day',
ALTER COLUMN "type" SET DEFAULT 'Market';

ALTER TABLE "public"."Transaction" ALTER COLUMN "status" SET DEFAULT 'PENDING';

CREATE UNIQUE INDEX "OrderEvent.type" ON "public"."OrderEvent"("type")

ALTER TABLE "public"."OrderEvent" ADD FOREIGN KEY ("scheduledEventId")REFERENCES "public"."ScheduledEvent"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200520182926-add-orders-to-stock-portfolio..20200525222437-order-event-model
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -220,4 +220,16 @@
   stockPortfolioId String
   @@unique([stockPortfolioId, type])
 }
+
+enum OrderEventType {
+  ExecuteOrders
+  ExpireOrders
+  CleanInvalidOrders
+}
+
+model OrderEvent {
+  scheduledEvent   ScheduledEvent @relation(fields: [scheduledEventId], references: [id])
+  scheduledEventId String         @id
+  type             OrderEventType @unique
+}
```


