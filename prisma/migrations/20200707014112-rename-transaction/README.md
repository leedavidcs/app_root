# Migration `20200707014112-rename-transaction`

This migration has been generated by leedavidcs at 7/7/2020, 1:41:12 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "PaymentTransactionStatus" AS ENUM ('FAILED', 'PENDING', 'SUCCEEDED');

CREATE TABLE "public"."PaymentTransaction" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"creditsBefore" integer  NOT NULL ,"creditsTransacted" integer  NOT NULL ,"id" text  NOT NULL ,"paymentIntentId" text   ,"status" "PaymentTransactionStatus" NOT NULL DEFAULT E'PENDING',"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Transaction" DROP CONSTRAINT IF EXiSTS "Transaction_userId_fkey";

CREATE UNIQUE INDEX "PaymentTransaction.paymentIntentId" ON "public"."PaymentTransaction"("paymentIntentId")

ALTER TABLE "public"."PaymentTransaction" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."Transaction";

DROP TYPE "TransactionStatus"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200707004837-with-optional-settings..20200707014112-rename-transaction
--- datamodel.dml
+++ datamodel.dml
@@ -2,13 +2,14 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
+  experimentalFeatures = ["transactionApi"]
 }
 model User {
   id              String   @id @default(cuid())
@@ -40,8 +41,13 @@
   userId         String
   name           String
   headers        Json[]
   tickers        String[]
+  // HACK
+  // description: This is made optional, because deleting stockPortfolio yeilds an error if made
+  //     required as of prisma@2.1.3
+  // date: July 7, 2020
+  // author: David Lee
   settings       StockPortfolioSettings?
   snapshots      Snapshot[]
   orders         Order[]
   latestSnapshot LatestSnapshot?
@@ -121,23 +127,23 @@
   userId  String @id
   credits Int    @default(0)
 }
-enum TransactionStatus {
+enum PaymentTransactionStatus {
   FAILED
   PENDING
   SUCCEEDED
 }
-model Transaction {
+model PaymentTransaction {
   id                String            @id @default(cuid())
   user              User              @relation(fields: [userId], references: [id])
   userId            String
   creditsBefore     Int
   creditsTransacted Int
   createdAt         DateTime          @default(now())
   paymentIntentId   String?           @unique
-  status            TransactionStatus @default(PENDING)
+  status            PaymentTransactionStatus @default(PENDING)
 }
 model StripeDetails {
   user       User   @relation(fields: [userId], references: [id])
```


