# Migration `20200414072514-new-webhook-model`

This migration has been generated by leedavidcs at 4/14/2020, 7:25:14 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "WebhookType" AS ENUM ('StockDataRetrieved');

CREATE TABLE "public"."Webhook" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "timeout" integer  NOT NULL DEFAULT 30000,
    "type" "WebhookType" NOT NULL ,
    "url" text  NOT NULL ,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Webhook" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200405070331-transaction-with-status..20200414072514-new-webhook-model
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
@@ -19,8 +19,9 @@
   createdAt     DateTime @default(now())
   updatedAt     DateTime @updatedAt
 }
+// Commented out until embedded types are available
 // model StockPortfolioHeader {
 //   id        String @id @default(cuid())
 //   name      String
 //   dataKey   String
@@ -54,19 +55,33 @@
   SUCCEEDED
 }
 model Transaction {
-  id                String   @id @default(cuid())
-  user              User     @relation(fields: [userId], references: [id])
+  id                String            @id @default(cuid())
+  user              User              @relation(fields: [userId], references: [id])
   userId            String
   creditsBefore     Int
   creditsTransacted Int
-  createdAt         DateTime @default(now())
-  paymentIntentId   String?  @unique
+  createdAt         DateTime          @default(now())
+  paymentIntentId   String?           @unique
   status            TransactionStatus @default(PENDING)
 }
 model StripeDetails {
   user       User   @relation(fields: [userId], references: [id])
   userId     String @id
   customerId String @unique
 }
+
+enum WebhookType {
+  StockDataRetrieved
+}
+
+model Webhook {
+  id        String @id @default(cuid())
+  user      User   @relation(fields: [userId], references: [id])
+  userId    String
+  type      WebhookType
+  url       String
+  timeout   Int      @default(30000)
+  createdAt DateTime @default(now())
+}
```


