# Migration `20200520000053-with-dual-side-relations`

This migration has been generated by leedavidcs at 5/20/2020, 12:00:53 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Order" ALTER COLUMN "status" SET DEFAULT 'Open',
ALTER COLUMN "timeInForce" SET DEFAULT 'Day',
ALTER COLUMN "type" SET DEFAULT 'Market';

ALTER TABLE "public"."Transaction" ALTER COLUMN "status" SET DEFAULT 'PENDING';

CREATE UNIQUE INDEX "Balance_userId" ON "public"."Balance"("userId")

CREATE UNIQUE INDEX "LatestSnapshot_stockPortfolioId" ON "public"."LatestSnapshot"("stockPortfolioId")

CREATE UNIQUE INDEX "StripeDetails_userId" ON "public"."StripeDetails"("userId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200519184540-change-stock-portfolio-market-value-to-buying-power..20200520000053-with-dual-side-relations
--- datamodel.dml
+++ datamodel.dml
@@ -2,24 +2,28 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id            String   @id @default(cuid())
-  email         String   @unique
-  emailVerified Boolean  @default(false)
-  password      String
-  username      String   @unique
-  timezone      String   @default("America/Los_Angeles")
-  createdAt     DateTime @default(now())
-  updatedAt     DateTime @updatedAt
+  id              String   @id @default(cuid())
+  email           String   @unique
+  emailVerified   Boolean  @default(false)
+  password        String
+  username        String   @unique
+  timezone        String   @default("America/Los_Angeles")
+  balance         Balance
+  stripeDetails   StripeDetails?
+  stockPortfolios StockPortfolio[]
+  transactions    Transaction[]
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
 }
 // Commented out until embedded types are available
 // model StockPortfolioHeader {
@@ -31,18 +35,24 @@
 //   resizable Boolean @default(true)
 // }
 model StockPortfolio {
-  id          String                 @id @default(cuid())
-  user        User                   @relation(fields: [userId], references: [id])
-  userId      String
-  name        String
-  headers     String[]
-  tickers     String[]
-  settings    StockPortfolioSettings
-  buyingPower Float                  @default(0)
-  createdAt   DateTime               @default(now())
-  updatedAt   DateTime               @updatedAt
+  id                   String                 @id @default(cuid())
+  user                 User                   @relation(fields: [userId], references: [id])
+  userId               String
+  name                 String
+  headers              String[]
+  tickers              String[]
+  settings             StockPortfolioSettings
+  orders               Order[]
+  positions            Position[]
+  stockPortfolioEvents StockPortfolioEvent[]
+  snapshots            Snapshot[]
+  latestSnapshot       LatestSnapshot?
+  webhooks             Webhook[]
+  buyingPower          Float                  @default(0)
+  createdAt            DateTime               @default(now())
+  updatedAt            DateTime               @updatedAt
   @@unique([userId, name])
 }
```


